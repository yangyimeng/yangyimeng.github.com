
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>修改jekyll的code block style &larr; </title>
   <meta name="author" content="YiMeng Yang" />

   <link rel="start" href="/" />

	
	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/feedname" title="RSS feed" />
	
	



   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/pygments.css" type="text/css" />
   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/syntax.css" type="text/css" />   
   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/assets/themes/mark-reid/css/screen.css" type="text/css" />
<style>
.ymy_div {
  width: 100%;
  height: 100px;
  margin-bottom: 40px;
}


.triangle-isosceles {
  position:relative;
  padding:15px;
  margin:1em 0 3em;
  color:#000;
  background:#EEE; /* default background for browsers without gradient support */
  /* css3 */
  background:-webkit-gradient(linear, 0 0, 0 100%, from(#EEE), to(#EEE));
  background:-moz-linear-gradient(#EEE, #EEE);
  background:-o-linear-gradient(#EEE, #EEE);
  background:linear-gradient(#EEE, #EEE);
  -webkit-border-radius:10px;
  -moz-border-radius:10px;
  border-radius:10px;
}

/* Variant : for top positioned triangle
------------------------------------------ */

.triangle-isosceles.top {
  background:-webkit-gradient(linear, 0 0, 0 100%, from(#EEE), to(#EEE));
  background:-moz-linear-gradient(#EEE, #EEE);
  background:-o-linear-gradient(#EEE, #EEE);
  background:linear-gradient(#EEE, #EEE);
}

/* Variant : for left/right positioned triangle
------------------------------------------ */

.triangle-isosceles.left {
  margin-left:50px;
  background:#EEE;
}

/* Variant : for right positioned triangle
------------------------------------------ */

.triangle-isosceles.right {
  margin-right:50px;
  background:#EEE;
}

/* THE TRIANGLE
------------------------------------------------------------------------------------------------------------------------------- */

/* creates triangle */
.triangle-isosceles:after {
  content:"";
  position:absolute;
  bottom:-15px; /* value = - border-top-width - border-bottom-width */
  left:50px; /* controls horizontal position */
  border-width:15px 15px 0; /* vary these values to change the angle of the vertex */
  border-style:solid;
  border-color:#EEE transparent;
    /* reduce the damage in FF3.0 */
    display:block; 
    width:0;
}

/* Variant : top
------------------------------------------ */

.triangle-isosceles.top:after {
  top:-15px; /* value = - border-top-width - border-bottom-width */
  right:50px; /* controls horizontal position */
  bottom:auto;
  left:auto;
  border-width:0 15px 15px; /* vary these values to change the angle of the vertex */
  border-color:#EEE transparent;
}

/* Variant : left
------------------------------------------ */

.triangle-isosceles.left:after {
  top:16px; /* controls vertical position */
  left:-50px; /* value = - border-left-width - border-right-width */
  bottom:auto;
  border-width:10px 50px 10px 0;
  border-color:transparent #EEE;
}

/* Variant : right
------------------------------------------ */

.triangle-isosceles.right:after {
  top:16px; /* controls vertical position */
  right:-50px; /* value = - border-left-width - border-right-width */
  bottom:auto;
  left:auto;
  border-width:10px 0 10px 50px;
  border-color:transparent #EEE;
}


#top-link {
    PADDING-RIGHT: 10px;     
    PADDING-LEFT: 10px; 
    FONT-WEIGHT: bold; 
    
    BACKGROUND: whiteSmoke; 
    PADDING-BOTTOM: 10px;
    filter:alpha(opacity=20);
    opacity:.2; 
    BOTTOM: 5px; 
    PADDING-TOP: 10px;     
    POSITION: fixed; 
    TEXT-DECORATION: none
}



</style>
  <script type="text/javascript" src="/assets/themes/mark-reid/scripts/miaov.js"></script>
  <script type="text/javascript" src="/assets/themes/mark-reid/scripts/shCore.js"></script>
  <script type="text/javascript" src="/assets/themes/mark-reid/scripts/shBrushJScript.js"></script>
  <link type="text/css" rel="stylesheet" href="/assets/themes/mark-reid/styles/shCoreDefault.css"/>
 <link type="text/css" rel="stylesheet" href="/assets/themes/mark-reid/styles/miaov_style.css"/>
 <script type="text/javascript">

    SyntaxHighlighter.all();
/**
 * 回到页面顶部
 * @param acceleration 加速度
 * @param time 时间间隔 (毫秒)
 **/
function goTop(acceleration, time) {
    acceleration = acceleration || 0.1;
    time = time || 16;
 
    var x1 = 0;
    var y1 = 0;
    var x2 = 0;
    var y2 = 0;
    var x3 = 0;
    var y3 = 0;
 
    if (document.documentElement) {
        x1 = document.documentElement.scrollLeft || 0;
        y1 = document.documentElement.scrollTop || 0;
    }
    if (document.body) {
        x2 = document.body.scrollLeft || 0;
        y2 = document.body.scrollTop || 0;
    }
    var x3 = window.scrollX || 0;
    var y3 = window.scrollY || 0;
 
    // 滚动条到页面顶部的水平距离
    var x = Math.max(x1, Math.max(x2, x3));
    // 滚动条到页面顶部的垂直距离
    var y = Math.max(y1, Math.max(y2, y3));
 
    // 滚动距离 = 目前距离 / 速度, 因为距离原来越小, 速度是大于 1 的数, 所以滚动距离会越来越小
    var speed = 1 + acceleration;
    window.scrollTo(Math.floor(x / speed), Math.floor(y / speed));
 
    // 如果距离不为零, 继续调用迭代本函数
    if(x > 0 || y > 0) {
        var invokeFunction = "goTop(" + acceleration + ", " + time + ")";
        window.setTimeout(invokeFunction, time);
    }
}

 </script>

</head>
<body id="">
<div id="site">
  
  <div id="header">
    <h1>
    	<a href="/" title="Jekyll Bootstrap">Jekyll Bootstrap</a>
    	<span class="byline">&larr; <a href="/">YiMeng Yang</a></span>
    </h1>
    <ul class="nav">
      <li><a class="home" href="/">Home</a></li>
      <li><a  href="/life.html">Life</a></li>
      <li><a  href="/work.html">Work</a></li>
      <li><a  href="/about.html">About</a></li>
      <li><a  href="/other.html">Other</a></li>
    </ul>
  </div>

  
<div id="page">
	
  <h1 class="emphnext">修改jekyll的code block style</h1>


  <p>现在流行用jekyll来运行个人的博客网站, 是一个小型的静态服务器.用的是ruby语言来实现的.笔者的博客也是用jekyll来搭建的,用起来很方便,很有装逼的感觉,呵呵,废话少说.马上进入正题.jekyll博客系统,用来markdown来方便用户进行写作,主要是让用户可以随意的写作,就可以很好的显示在网页上面,当中对于代码的显示,用了code block来特意的标明代码区, 但是原始的代码块没有高亮显示语法,因此用起来不爽.因此,笔者的文章的目的就在于使得jekyll的默认的code block具有语法高亮.</p>

<h1 id='markdown'>markdown的认知</h1>

<p>Markdown 的目标是实现「易读易写」, 而jekyll就是使用了Markdown来作为文章的书写语言,我们需要来关注的是markdown的一个特殊的功能.</p>

<h2 id='markdown'>markdown代码区块</h2>

<p>和程序相关的写作或是标签语言原始码通常会有已经排版好的代码区块，通常这些区块我们并不希望它以一般段落文件的方式去排版，而是照原来的样子显示，Markdown 会用 &#60;pre&#62;和&#60;code&#62;标签来把代码区块包起来。</p>

<p>要在 Markdown 中建立代码区块很简单，只要简单地缩进 4 个空格或是 1 个制表符就可以，例如，下面的输入： <pre class='brush: js;'>
	这是一个普通段落：
	    这是一个代码区块。
</pre> Markdown 会转换成： <pre class='brush: js;'>
	<p>这是一个普通段落：</p>
	<pre><code>这是一个代码区块。
	</code></pre>
</pre></p>

<h1 id='id12'>改造的目标样式</h1>

<p>通过上面, 我们知道markdown会识别出缩进 4 个空格或是 1 个制表符的特殊区块,然后用pre标签进行封装,以显示出代码的特效.只不过呢,原始的特效不好看,因此,我们需要对这个特效进行修改.</p>

<p>上面的说明让我们知道,我们有办法对默认的样式进行修改,但是首先要找到一个好看的样式来替换旧的样式.</p>

<h2 id='syntaxhighlighter'>SyntaxHighlighter</h2>

<p>SyntaxHighlighter是一个开源的html高亮的css项目,效果如下,怎样,挺不错的吧. <pre class='brush: js;'>
	// SyntaxHighlighter makes your code snippets beautiful without tiring your servers.
	// http://alexgorbatchev.com
	var setArray = function(elems) {
	    this.length = 0;
	    push.apply(this, elems);
	    return this;
	}
</pre></p>

<h1 id='markdown'>开始改造markdown</h1>

<p>现在我们既知道可以修改旧样式,又有了我们的新样式, 恩,不错,我们已经可以开始动工了.</p>

<h2 id='syntaxhighlighterjekyll'>下载SyntaxHighLighter,并放入jekyll网站项目里</h2>

<p><a href='http://alexgorbatchev.com/SyntaxHighlighter/'>下载</a>SyntaxHighLighter</p>

<p>笔者使用的是<a href='http://alexgorbatchev.com/SyntaxHighlighter/download/download.php?sh_current'>syntaxhighlighter_3.0.83</a></p>

<p>下载后,把压缩包里的四个文件夹 compass, scripts, src, styles 全部的都放到jekyll的assets/themes/your-theme-name路径下面.</p>

<p>最后, 要在default.html里面include一些必要的css,js文件.如下:</p>
<pre class='brush: js;'>
	  <script src='/assets/themes//scripts/shCore.js' type='text/javascript' />
	  <script src='/assets/themes//scripts/shBrushJScript.js' type='text/javascript' />
	  <link href='/assets/themes//styles/shCoreDefault.css' rel='stylesheet' type='text/css' />
	  <script type='text/javascript'>SyntaxHighlighter.all();</script>
</pre>
<h2 id='id13'>找到要修改的源码的地方</h2>

<p>由于笔者使用的是ubuntu系统,因此可以通过如下的命令来找到要修改的源码的地方. <pre class='brush: js;'>
	xxx@ubuntu:~$ which jekyll 
	/home/xxx/.rvm/gems/ruby-1.9.2-p320/bin/jekyll
</pre> 呵呵,其中xxx就是你的用户名了, 不错, 源码的路径就应该是在/home/xxx/.rvm/gems/ruby-1.9.2-p320这个地方附近了.</p>

<p>一般的话, 要修改的文件的路径应该是 <pre class='brush: js;'>
	/home/xxx/.rvm/gems/ruby-1.9.2-p320/gems/maruku-0.6.1/lib/maruku/output/to_html.rb
</pre></p>

<p>很好, 我们的工作进入到了很关键的时刻了, 因为我们就要开始动手修改ruby markdown的源码了.呵呵,事实上, 我们所要修改的ruby的源码只是很少的一部分.</p>

<p>请把这个文件的下面的函数改造成下面的代码,就ok了.很简单的,看看就懂了. <pre class='brush: js;'>
		def to_html_code_using_pre(source)
			pre = create_html_element  'pre'
			s = source
			pre.attributes['class'] = 'brush: js;'		
			s = Text.normalize(s)
			s  = s.gsub(/\&apos;/,'&#39;') # IE bug
			s  = s.gsub(/'/,'&#39;') # IE bug
			if get_setting(:code_show_spaces) 
				# 187 = raquo
				# 160 = nbsp
				# 172 = not
				s.gsub!(/\t/,'&#187;'+'&#160;'*3)
				s.gsub!(/ /,'&#172;')
			end
			text = Text.new(s, respect_ws=true, parent=nil, raw=true )
			pre &lt;&lt; text
			pre
		end
</pre></p>

<h1 id='id14'>看看改造的效果吧.</h1>

<p>呵呵,效果就在上面, 你们只要对想要显示的代码缩进四个空格或者一个制表,就可以显示出上面的特效了.</p>

<p>不过呢, 有一点需要各位注意的是, 若是你要把博客挂在github上的话, 那你修改的只是本地的markdown,可是github上的markdown你并没有修改到,因此,效果就会出不来.笔者过后会用另外的方法来介绍一下,若是要把博客挂在github上,又要显示出上面的特效的方法.</p>

<h2 id='id15'>参考文章</h2>

<ul>
<li><a href='http://ruby-doc.org/'>ruby参考文档</a></li>

<li><a href='http://pine.fm/LearnToProgram/'>ruby教程</a></li>
</ul>

  <address class="signature">
    <a class="author" href="/">YiMeng Yang</a> 
    <span class="date">25 September 2012</span>
    <span class="location"></span>
  </address>
  
  <div class="prev-next">
  
    <a href="/linux clanguage work/2012/09/27/linux-" class="next" title="linux 链表的技巧">Next Post &rarr;</a>
  
  
    <a href="/linux work script/2012/09/24/jekyll--ruby-install" class="prev" title="jekyll and ruby install">&larr; Earlier Post</a>
  
  </div>
  
</div><!-- End Page -->




  
  <div id="footer">
  	<address>
  		<span class="copyright">
  			Content by <a href="/info/site.html">YiMeng Yang</a>. Design by 
  			<a href="http://mark.reid.name/">Mark Reid</a>
  			<br/>
  			(<a rel="licence" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Some rights reserved</a>)			
  		</span>
  		<span class="engine">
  			Powered by <a href="http://github.com/mojombo/jekyll/" title="A static, minimalist CMS">Jekyll</a>
  		</span>
  	</address>
  </div>
  
</div>

<!--[if IE 6]>
<script type="text/javascript"> 
	/*Load jQuery if not already loaded*/ if(typeof jQuery == 'undefined'){ document.write("<script type=\"text/javascript\"   src=\"http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js\"></"+"script>"); var __noconflict = true; } 
	var IE6UPDATE_OPTIONS = {
		icons_path: "http://static.ie6update.com/hosted/ie6update/images/"
	}
</script>
<script type="text/javascript" src="http://static.ie6update.com/hosted/ie6update/ie6update.js"></script>
<![endif]-->

  

<a id=top-link onclick="goTop();return false;" href="javascript:void(0);"><img src="/images/uparrow.png"  title="返回顶部" /></a> 



</body>
</html>

